# Використання кривих Без'є в комп'ютерній графіці

### Теоретичні відомості

Одним із базових розділів комп’ютерної графіки є розділ, який досліджує зображення математичних кривих на площині і в просторі. Існує безліч способів побудови кривих вручну за допомогою олівця, ручки, пензлика та різноманітних інструментів: лінійки, лекала, циркуля, шаблону і т.д. Кожен інструмент відповідає своїй певній меті, але серед них немає жодного універсального. Так і в комп'ютерній графіці криві будуються за допомогою різних методів та інструментів.

Під час конструювання математичних моделей кривих ліній найчастіше зустрічаються такі задачі: 

--апроксимації;

--інтерполяції;

--згладжування.

Задача *апроксимації* (наближеного представлення) виникає під час заміни кривої, що описується рівнянням функцій складної природи (наприклад з точки зору швидкодії обчислень її значень і похідних, інтегрування, диференціювання), іншою кривою, в деякому наближенні близької до заданої, рівняння якої більш просте.

Задача *інтерполяції* (наближеного відновлення) виникає, коли дана скінчена множина точок, через які потрібно провести криву. До форми і гладкості відновлюваної кривої можуть висуватись додаткові вимоги.

Задача *згладжування* кривих полягає у відновленні гладкої функції, тобто потрібно побудувати криву, що проходить поблизу заданих точок із заданим допустимим відхиленням. Така задача має багато розв’язків, однак, наклавши на задану функцію додаткові умови, можна досягти необхідної однозначності.

Існує велика кількість методів розв’язку згаданих вище задач. Кожний з них є ефективним для свого класу об’єктів. У багатьох підсистемах комп’ютерної графіки і геометричних розрахунках перевага надається кусково-поліноміальним методам і представленням.

Сплайн є одним зі способів побудови кривих, поверхонь складної форми, які були вперше використані для математичного опису форми нових автомобілів, літаків, космічних кораблів, побутових приладів під час їхнього проектування.

Сплайн – це гладка крива, яка будується з використанням дуг і проходить через кілька контрольних точок, що керують формою сплайна. Іншими словами, сплайн – функція, область визначення якої розбита на фрагменти (сегменти), на кожному з яких функція є деяким поліномом (многочленом). Максимальний степінь поліномів в сплайні називається степенем сплайна.

Один із найбільш загальних типів сплайнів є криві Безьє, розроблені математиком П'єром Безьє. Криві та поверхні Безьє використовувалися в 60-х роках компанією "Рено" для комп'ютерного проектування форми кузовів автомобілів. Хоча варто зауважити, що в [1959](http://uk.wikipedia.org/wiki/1959) р. криві Безьє використовувались [Полем де Кастельє](http://en.wikipedia.org/wiki/Paul_de_Casteljau) з компанії [«Сітроен»](http://uk.wikipedia.org/wiki/PSA_Peugeot_Citroën), але його дослідження не публікувались і приховувались компанією як [комерційна таємниця](http://uk.wikipedia.org/wiki/Комерційна_таємниця) до кінця 1960-х. Згодом це відкриття стало одним з найважливіших інструментів систем автоматизованого проектування та програм комп'ютерної графіки.

1.       Крива Безьє

Крива Безьє – основа векторної графіки. Застосування кривої Безьє є досить широким: спосіб управління рухом, засіб створення анімаційних рисунків, метод опису художніх шрифтів, спосіб передачі виділених об’єктів, інтерактивний інструмент дизайну форми різноманітних об’єктів.

Безьє розробив метод зображення кривої, який створює у користувача більш природне сприйняття. Крива Безьє визначається вершинами багатокутника, який задає форму кривої. Кривій належить перша та остання вершина, в той час як інші вершини характеризують похідні, порядок та вид кривої. Таким чином, крива задається за допомогою відкритого багатокутника (ламаної) сформованого заданими точками, як показано на рис 4.

Так як вигляд кривої залежить від форми багатокутника, то зміна положення вершин цього багатокутника створює у користувача значно більше явного відчуття сприймання зв’язку між входом і виходом. Для того щоб збільшити порядок будь-якого криволінійного сегменту, потрібно тільки задати додаткові вершини. Така методика відрізняється значною гнучкістю і позбавлена багатьох недоліків.

Для побудови кубічної кривої Безьє (яку найчастіше використовують) необхідно мати 4 *контрольні* точки. Але крива проходить лише через дві з них, які називаються *опорними*, у свою чергу перша є початковою, друга – кінцевою. Інші дві точки, через які не проходить крива, називаються *керуючими*.

Якщо зміщуються початкова та кінцева точки, то крива теж відповідно змінюватиме свій вигляд. Зміщення керуючих точок змінить кривизну відповідної частини кривої Безьє. Таким чином за допомогою переміщення контрольних точок можна отримати безмежну кількість форм кривої Безьє.

Для побудови кривої Безьє в комп’ютерній графіці використовують три основні способи: параметричний, рекурсивний, матричний.

2.       Параметричний вигляд кривої Безьє

На початку ХХ ст.Сергій Натанович Бернштейн, що закінчив Харківський університет, під час доведення теореми Стоуна-Вейєрштрасса вперше вивів поліноми, що будуються в явному вигляді, які і стали основою для отримання сплайнів, в тому числі і кривих Безьє.

Тобто крива Безьє – це лінійна комбінація базисних поліномів Бершнштейна степені *n,*

Розглянемо криві Безьє, що класифікуються за значенням *n:*

1. *n*=1 (за двома точками). Крива вироджується у відрізок, що визначається опорними точками *P*0 и *P*1. Параметричне представлення:
   *B*(*t*)=(1-*t*)*P*0 + *tP*1.

2. *n*=2 (за трьома точками). Параметричне рівняння має вигляд:
   *B*(*t*)=(1-*t*)2*P*0 + 2*t*(1-*t*)*P*1 + *t*2*P*2.

Ø   *n*=3 (за чотирма точками – кубічна). Використовується досить часто, особливо в сплайнах. Параметричне рівняння:

*B*(*t*)=(1-*t*)3*P*0 + 3*t*(1-*t*)2*P*1 + 3*t*2(1-*t*)*P*2 + *t*3*P*3.

*Властивості многочленів* Бернштейна суттєво впливають на поведінку кривих Безьє. Наведемо деякі з них:

1. Многочлени Бернштейна набувають невід’ємних значень.

2. У сумі вони дають одиницю.
3. Многочлени не залежать від вершин масиву *P*, а залежать лише від кількості точок у масиві.

*Геометричний алгоритм* для кривої Безьє дозволяє обчислити координати (*x, y*) точки кривої Безьє за значенням параметра *t*.

1. Кожна сторона опорної ламаної ділиться у відношенні *t:*(1- *t*), де *t –* аргумент точки поділу.

2. Точки поділу з'єднуються відрізками прямих і утворюють нову ламану (багатокутник). Кількість вузлів нового контуру на одиницю менша, ніж кількість вузлів попереднього контуру.

3. Сторони нового контуру знову діляться пропорційно значенню *t* і т.д. Це продовжується до тих пір, поки не буде отримана єдина точка поділу – точка кривої Безьє.

 Метод побудови кривої Безьє заснований на використанні пари дотичних (керуючих ліній), проведених до кінців сегмента кривої. На форму кривої впливають кут нахилу дотичної і довжина її відрізка.

3. Матричний та рекурсивний вигляд кривої Безьє

Рівняння кривої Безьє також можна записати у *матричній формі*.

Також існує рекурсивна формула побудови кривих Безьє, автором якоїє Поль де Кастельє:

### Властивості кривої Безьє

У процесі інтерактивного конструювання ламана Безьє є засобом управління формою. Ефективність методу обумовлена такими *властивостями кривих Безьє:*

1. Порядок точок у масиві *Р* суттєво впливає на вигляд кривої Безьє.

2. Форма кривої Безьє повторює хід ламаної *P*0*P*1…*Pn*. При зміні порядку точок повністю змінюється форма кривої.

3. Перша та остання точки кривої збігаються з відповідними точками масиву *P*, тобто *B*(0) = *P*0, *B*(1) = *Pn*. Усі інші вершини ламаної в загальному випадку знаходяться поза кривою.

4. Нахил дотичних векторів в крайніх точках кривої співпадає з нахилом, відповідно першої та останньої ланки ламаної Безьє.

5. У рівнянні, що описує елементарну криву Безьє, немає вільних параметрів, тобто заданий масив однозначно визначає криву Безьє. Тому немає можливостей якимось чином впливати на форму кривої Безьє.

6. Крива Безьє інваріантна відносно афінних перетворень. Тобто побудувавши криву Безьє, над нею можна здійснити афінні перетворення, а можна вчинити інакше: спочатку здійснити афінні перетворення над опорними вершинами, а потім побудувати криву Безьє на нових вершинах. Якщо результати будуть однаковими, то кажуть, що крива є інваріантною відносно цього афінного перетворення. При цьому легко помітити, наприклад, що поворот опорних вершин і подальша побудова кривої займає менше часу, ніж поворот самої кривої. Нагадаємо, що афінні перетворення включають у себе поворот, розтягування/стиск, паралельне перенесення та їх можливі комбінації.

7. Крива Безьє лежить в опуклій оболонці вершин масиву *P*.

Змістовно многочлен Безьє можна представити як деяку намагнічену еластичну стрічку, закріплену в першій і останній точках. Стрічка притягується до кожної точки, причому чим вища напруженність магнітного поля в точках, тим ближче буде притягнута до них. Під час прямування кратності до нескінченості многочлен Безьє прямує до ламаної кривої, точками спряження для якої служать точки-орієнтири.

Практичне конструювання кривих за методом Безьє є евристичною процедурою. Спочатку конструктор вручну накидує бажану криву. Пізніше він вказує вершини ламаної Безьє, яка на його думку, створить перше наближення до необхідної кривої. Наступним кроком є пересування вершин таким чином, щоб поступово покращити співпадання чи наближення. Якщо необхідно, деякі вершини викидаються або додаються нові.

Поряд з перевагами, криві Безьє мають і *ряд недоліків* :

1. Степінь функціональних поліномів напряму залежить від кількості точок у заданому векторі. Степінь многочлена *B*(*t*), що визначає криву Безьє, на одиницю менший від кількості точок масиву, тобто крива Безьє побудована на *n*+1 точці задається многочленом степеня *n.*

2. Якщо в масив *P* додати хоча б одну вершину, то необхідно повністю перерахувати параметричні рівняння кривої Безьє

3. Зміна хоча б однієї точки в масиві *P* приводить до помітної зміни всієї кривої Безьє.

Незважаючи на недоліки, крива Безьє є зручною для використання в задачах комп’ютерної графіки, оскільки формула є достатньо простою з точки зору математичних обчислень, універсальною з точки зору програмування, геометрично наглядною з точки зору користувача – художника, дизайнера, проектувальника.

5. [Приклади]побудови кривої Безьє

***Приклад 1.\*** Нехай маємо набір точок *Р0*=[1,1], *Р1*=[2,3], *Р2*=[4,3], *P3*=[3,1], що є вершинами багатокутника.

 Використаємо параметричну формулу побудови кривої Безьє:

Тут *n*=3, оскільки маємо 4 вершини. 

Коефіцієнти для кривої Безьє наведені у таблиці:

*Таблиця 1.*

| *t*  | *b3,0* | *b**3,1* | *b**3,2* | *b**3,3* |
| ---- | ------ | -------- | -------- | -------- |
| 0    | 1      | 0        | 0        | 0        |
| 0.15 | 0.614  | 0.325    | 0.0574   | 0.0034   |
| 0.35 | 0.275  | 0.444    | 0.239    | 0.043    |
| 0.5  | 0.125  | 0.375    | 0.375    | 0.125    |
| 0.65 | 0.043  | 0.239    | 0.444    | 0.275    |
| 0.85 | 0.0034 | 0.0574   | 0.325    | 0.614    |
| 1    | 0      | 0        | 0        | 1        |

 

*Примітка.* Для того, щоб складена кубічна крива Безьє була *C*1-гладкою необхідно, щоб трійки вершин *P*3*i* – 1, *P*3*i* , *P*3*i* + 1 лежали на одній прямій. Тобто розбиваємо масив точок *P*0, *P*1,…, *Pn* на *l* підмножин таким чином:

{*P*0, *P*1, *P*2, *P*3}, {*P*1, *P*2, *P*3, *P*4}, …, {*P*3*l*, *P*3*l* + 1, *P*3*l* + 2, *P*3*l* + 3}.

Відрізок {*P*0, *P*1, *P*2, *P*3}, описує криву між точками *P*1 та *P*2, а відрізок {*P*1, *P*2, *P*3, *P*4} між точками *P*2 та *P*3 і т.д. Гладкість зшивання відрізків буде залежати від порядку полінома(чим вищий порядок, тим гладше будуть зшиватись відрізки). На границях необхідно вибрати умову, наприклад, що відповідні похідні рівні нулю.

***Зауваження!\*** *Метод побудови кривої Безьє в графічних пакетах базується на використанні дотичних управляючих ліній, що проведені до сегмента кривої на його кінцях (вузлах). При цьому форму кривої Безьє моделюють шляхом зміни нахилу дотичних і довжини відрізка, які визначаються контрольними точками.*

**Висновки**

Завдяки простоті задачі та маніпуляції, криві Безьє знайшли широке застосування в комп'ютерній графіці для моделювання гладких ліній. Крива цілком лежить в опуклій оболонці своїх контрольних точок. Ця властивість кривих Безьє з одного боку значно полегшує завдання знаходження точок перетину кривих (якщо не перетинаються опуклі оболонки опорних точок, то не перетинаються і самі криві), а з іншого боку дозволяє здійснювати інтуїтивно зрозуміле управління параметрами кривої в графічному інтерфейсі за допомогою її опорних точок. Крім того афінне перетворення кривої (перенесення, масштабування, обертання та ін) також можуть бути здійснені шляхом застосування відповідних трансформацій до опорних точок.

Найбільше значення мають криві Безьє другого та третього ступенів (квадратичні і кубічні). Криві вищих ступенів під час обробки вимагають більшого обсягу обчислень і для практичних цілей використовуються рідше. Для побудови ліній складних форм окремі криві Безьє можуть бути послідовно з'єднані один з одним. Для того, щоб забезпечити гладкість лінії у місці з'єднання двох кривих, три суміжні контрольні точки обох кривих повинні лежати на одній прямій. У програмах векторної графіки на зразок Adobe Illustrator або Inkscape подібні фрагменти відомі під назвою «шляхів» (path).

**Контрольні питання**

1. Що таке сплайн?

2. У якій задачі вперше використано апарат кривих Безьє?

3. Яким значенням параметру відповідають початкова та кінцева опорні точки? Доведіть це.

4. Чому крива Безьє вважається зручною для використання в задачах комп’ютерної графіки?

5. Чим визначається степінь кривої Безьє?

6. Як змінюється параметр у формулі кривої Безьє?

7. Назвіть недоліки кривих Безьє.

8. Запишіть рекурсивну формулу кривої Безьє.

9. Назвіть корисні властивості кривої Безьє.

10. Чи можна переставити місцями опорні точки без зміни вигляду кривої Безьє?

11. Що таке характеристичний багатокутник кривої Безьє?

12. Запишіть параметричний вигляд кривої Безьє.